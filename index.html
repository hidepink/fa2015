<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">

    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
    Remove this if you use the .htaccess -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>프로야구 스토브리그 놀이</title>
    <meta name="description" content="">
    <meta name="author" content="Sehwan Kim">

    <meta name="viewport" content="width=device-width; initial-scale=1.0">

    <!-- Replace favicon.ico & apple-touch-icon.png in the root of your domain and delete these references -->
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="css/style.css">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="stylesheet" href="js/flipclock/flipclock.css">

    <!-- CSS Links for Bootstrap APOLLO -->
    <link rel="stylesheet" href="./js/apollo/bootstrap.css" media="screen">
    <link rel="stylesheet" href="./js/apollo/bootstrap-apollo.css" media="screen">

    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="stylesheet" href="./js/apollo/plugins/alertify/alertify.core.css"/>
    <link rel="stylesheet" href="./js/apollo/plugins/alertify/alertify.bootstrap.css"/>
    <link rel="stylesheet" href="./js/apollo/plugins/iosOverlay/iosOverlay.css"/>

    <link href="    //cdn.jsdelivr.net/jquery.gray/1.3.6/gray.min.css" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js">IE7_PNG_SUFFIX = ".png";</script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js"></script>
    <![endif]-->
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="//cdn.jsdelivr.net/jquery.gray/1.3.6/jquery.gray.min.js"></script>
    <script src="https://raw.githubusercontent.com/twbs/bootstrap/master/js/affix.js"></script>
    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '291275374395819',
                status: true,
                cookie: true,
                xfbml: true,
                version: 'v2.2'
            });
        };
        ( function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {
                return;
            }
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));


        FB.Event.subscribe('auth.login', function (response) {
            document.location.reload();
        });

        function fb_share(myresultStr) {
            FB.getLoginStatus(function (response) {
                if (response.status === 'connected') {
                    var r = confirm("선정결과를 페이스북으로 공유하시겠습니까?");
                    if (r == true) {
                        var app_link = "http://kimsehwan.com/kia20/";
                        var app_thumnail = "http://kimsehwan.com/kia20/";
                        //var app_thumnail="http://ghkdxodn.tistory.com/"+data.image_name;
                        //var app_thumnail="http://ghkdxodn.tistory.com/show_img.php?no="+data.no;
                        FB.api('/me/feed', 'post', {message: myresultStr + "\n" + app_link, link: app_thumnail});
                        //FB.api('/me/feed', 'post', {message: myresultStr+"\n"+app_link});
                        alert('공유되었습니다.\n');
                    } else {

                    }

                    // 안드로이드에서는 등록 잘되는데.. 아이폰에서 등록 안됨 ㅡㅡ

                } else if (response.status === 'not_authorized') {
                    //FB.login();
                    FB.login(function () {
                    }, {scope: 'publish_actions'}); //로그인하면서 글쓰기 권한
                } else {
                    //FB.login()
                    FB.login(function () {
                    }, {scope: 'publish_actions'}); //로그인하면서 글쓰기 권한
                }
            });
        }
    </script>
</head>

<body>
<div class="container">
    <br>

    <div
            class="fb-like"
            data-share="true"
            data-width="450"
            data-show-faces="true">
    </div>
    <br><br>

    <h1 style="color:#ffffff">프로야구 스토브리그 놀이</h1>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h2>올해의 FA 등록 선수
                <small>총 19명</small>
            </h2>
        </div>
        <div class="panel-body">
            <p>원 소속팀 협상기간 <span class="dday"></span>일 남음 (11월 20일 ~ 11월 26일)</p>

            <div id="fa-players">
            </div>
        </div>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading">
            <h2>보호 선수 명단 만들기
                <small></small>
            </h2>
        </div>
        <div class="panel-body">
            <ul class="team-btn-container">
                <li><a href="#" class="teamBtn teamKA"><img class="grayscale" src="images/team/emblemB_HT.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamHH"><img class="grayscale" src="images/team/emblemB_HH.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamLG"><img class="grayscale" src="images/team/emblemB_LG.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamLT"><img class="grayscale" src="images/team/emblemB_LT.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamOB"><img class="grayscale" src="images/team/emblemB_OB.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamNC"><img class="grayscale" src="images/team/emblemB_NC.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamSK"><img class="grayscale" src="images/team/emblemB_SK.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamSS"><img class="grayscale" src="images/team/emblemB_SS.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamWO"><img class="grayscale" src="images/team/emblemB_WO.png"/></a>
                </li>
                <li><a href="#" class="teamBtn teamKT"><img class="grayscale" src="images/team/emblemB_KT.png"/></a>
                </li>
            </ul>
            <div class="clear"></div>

            <div class="row players-container">
                <div class="col-xs-4">
                    <div id="board">
                        <h3>현재보호선수: <span class="player-count">0</span>명 / 20명</h3>
                    </div>
                    <div class="clear"></div>
                    <div class="myPick">
                        <button class="sendmessage">
                            페이스북에 결과올리기
                        </button>
                        <button class="copymessage">
                            클립보드에 복사하기
                        </button>
                        <div class="clear"></div>
                        <h2>나의 선택</h2>

                        <div class="myPickContainer"></div>
                    </div>
                </div>
                <div class="col-xs-8">
                    <div>
                    <h2>투수</h2>

                    <div id="pitcher">

                    </div>

                    <div class="clear"></div>
                    <h2>타자</h2>

                    <div id="batter">
                    </div>
                    <div class="clear"></div>

                    <div id="in">

                    </div>

                    <div class="clear"></div>

                    <div id="out">

                    </div>

                    <div class="clear"></div>

                    <div id="catcher">

                    </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="clear" style="padding-top:50px;">
        * 본 사이트에 사용된 이미지는 포털사이트와 프로야구 각 구단 홈페이지에서 캡쳐했습니다.
    </div>
</div>
</body>

<script src="data/kia.json"></script>
<script src="data/fa.json"></script>
<script>
    $(document).ready(function () {
        var count = 0;

        function getFAPlayers(arr, id) {
            var out = "";
            var i;
            var path = "images/fa/";

            for (i = 0; i < arr.length; i++) {

                if (arr[i].stat == "re") {
                    out += '<div class="thumbnail fa ' + id + i + '"><a class="fa-player-card ' + '" href="#">';
                    out += '<span class="fa-player-watermark fa-re">재계약</span>';
                } else if (arr[i].stat == "yet") {
                    out += '<div class="thumbnail fa ' + id + i + '"><a class="fa-player-card ' + '" href="#">';
                    out += '<span class="fa-player-watermark fa-yet">영입가능</span>';
                } else {
                    out += '<div class="thumbnail fa ' + id + i + '"><a class="fa-moved-player-card ' + '" href="#">';
                    out += '<span class="fa-player-watermark fa-move">' + arr[i].stat + '</span>';
                }

                out += '<div class="fa-player-image"><img src="' + path + arr[i].img + '.jpeg"/></div>' +
                '<div class="caption"> ' + arr[i].name + '(' + arr[i].team + ')';

                if (arr[i].stat != "re" && arr[i].stat != "yet") {
                    out += '<br><span class="label label-default"><span class="label label-danger">보상</span> ' + arr[i].trade + '</span></div></div></a></div>';
                } else {
                    out += '</div></a></div>';
                }
            }
            $("#" + id).html(out);
        }

        function getTeam(teamname) {

            /* 내용 삭제 하기 */
            $("#pitcher").empty();
            $("#in").empty();
            $("#out").empty();
            $("#catcher").empty();
            $("#batter").empty();
            $(".myPickContainer").empty();

            count = 0;
            $(".player-count").html(count);


            switch (teamname) {
                case "teamKA":
                    getPlayers("KA", kiaPitchers, "pitcher");
                    getPlayers("KA", kiaOutfilders, "out");
                    getPlayers("KA", kiaInfilders, "in");
                    getPlayers("KA", kiaCatchers, "catcher");
                    break;
                case "teamSS":
                    getPlayers("SS", ssPitchers, "pitcher");
                    getPlayers("SS", ssBatters, "batter");
                    break;
                case "teamDS":
                    break;
                case "teamHH":
                    break;
                case "teamNC":
                    break;
                case "teamNX":
                    break;
                case "teamLT":
                    break;
                case "teamLG":
                    break;
                case "teamKT":
                    break;
                case "teamSK":
                    break;
            }
        }

        function getPlayers(team, arr, id) {
            var out = "";
            var i;
            var path;

            switch (id) {
                case "pitcher":
                    path = "images/" + team + "/p/";
                    break;
                case "in":
                    path = "images/" + team + "/i/";
                    break;
                case "out":
                    path = "images/" + team + "/o/";
                    break;
                case "catcher":
                    path = "images/" + team + "/c/";
                    break;
                case "batter":
                    path = "images/" + team + "/b/";
                    break;
            }


            for (i = 0; i < arr.length; i++) {
                if (arr[i].stat == "FA") {
                    out += '<div class="card-fa ' + id + i + '"><a class="player-card ' + '" href="#">';
                } else {
                    out += '<div class="' + id + i + '"><a class="player-card ' + '" href="#">';
                }
                if (arr[i].stat == "FA") {
                    out += '<span class="player-watermark">FA</span>';
                }
                if (arr[i].stat == "외국인") {
                    out += '<span class="player-watermark">외</span>';
                }
                out += '<img class="player-image" src="' + path + arr[i].img + '"/>' + '<span class="player-text"> ' + arr[i].name + '</span>' + '</a></div>';
            }


            $("#" + id).html(out);
        }

        function sortJSON(data, key, way) {
            return data.sort(function (a, b) {
                var x = Number(a[key]);
                var y = Number(b[key]);
                if (way === '123') {
                    return ((x < y) ? -1 : ((x > y) ? 1 : 0));
                }
                if (way === '321') {
                    return ((x > y) ? -1 : ((x < y) ? 1 : 0));
                }
            });
        }

        getFAPlayers(arrFAPlayers, "fa-players");

        $(".player-card").live("mouseover", function () {
            $(this).css({
                "border": "5px solid #cccccc",
                "padding": "1px"
            });
        });
        $(".player-card").live("mouseout", function () {
            $(this).css({
                "border": "1px solid #eeeeee",
                "padding": "5px"
            });
        });
        $(".player-card").live("click", function () {
            event.preventDefault();
            event.stopPropagation();

            if ($(this).hasClass("active")) {
                $(".myPickContainer").find("." + $(this).parent().attr("class")).hide();

                $("." + $(this).parent().attr("class") + " > a").removeClass("active");
                $("." + $(this).parent().attr("class") + " > a").css({
                    "background": "#ffffff"
                });

                count--;

                if (count <= 0) {
                    // $(".myPickContainer").html('<h3>아직 아무도 선택하지 않았습니다.</h3>');
                }
            } else {
                if (count >= 20) {
                    alert("보호명단 20명을 모두 선택했습니다!");
                    return false;
                }
                if ($(this).parent().hasClass("card-fa")) {
                    alert("FA는 보호명단에 묶이지 않습니다");
                    return false;
                }
                $(this).addClass("active");

                count++;

                $(this).css({
                    "border": "1px solid #eeeeee",
                    "padding": "5px"
                });
                $(this).css({
                    "background": "#000000"
                });
                $(this).parent().clone().removeClass("active").appendTo($(".myPickContainer"));
            }

            $(".player-count").html(count);

        });

        function getList() {
            var str = "내가 뽑은 보호선수 명단:";
            var strMax = $(".myPickContainer").contents().size();

            for (i = 0; i < strMax; i++) {
                str += $(".myPickContainer").children().eq(i).find(".player-text").html();
            }

            return str;
        }

        function copyToClipboard() {
            var text = getList();
            if (window.clipboardData) {
                // IE처리
                // 클립보드에 문자열 복사
                window.clipboardData.setData('text', text);

                // 클립보드의 내용 가져오기
                // window.clipboardData.getData('Text');

                // 클립보드의 내용 지우기
                // window.clipboardData.clearData("Text");
            } else {
                // 비IE 처리    
                window.prompt("Ctrl+C를 눌러 복사하세요!, Enter", text);
            }
        }

        $(".sendmessage").click(function () {
            if (count < 20) {
                alert("선택하신 보호명단이 20명이 안됩니다!");
                return false;
            } else {

                fb_share(getList());
            }
        });

        $(".copymessage").click(function () {
            copyToClipboard();
        });

        $(".teamBtn").click(function () {
            event.preventDefault();
            event.stopPropagation();
            $(".grayscale").removeClass("disable");
            $(this).find(".grayscale").addClass("disable");

            var team = $(this).attr("class");
            team = team.replace("teamBtn ", "");

            $(".players-container").css({"display": "block"});
            getTeam(team);
        })

        var now = new Date();
        var then = new Date('Nov 26,2014');
        var gap = now.getTime() - then.getTime();
        gap = Math.floor(gap / (1000 * 60 * 60 * 24)) * -1;
        $(".dday").html(gap);

        $(".teamBtn img").addClass("disable");



    });
</script>
</html>
